CHALLENGES := $(dir $(wildcard ./*/*/docker-compose.yml))

docker.build pathwar.prepare pathwar.push pathwar.register:
	for dir in $(CHALLENGES); do set -e; \
	  cd $$dir && make $@ && cd -; \
	done

_ci: docker.build

.PHONY: generate-register
generate-register: pathwar.push
	echo "# this file is generated by 'make generate-register'" > _register.sh
	echo "" >> _register.sh
	for dir in $(CHALLENGES); do set -e; \
	  echo "# $$dir" >> _register.sh; \
	  pathwar compose register --print $$dir/pathwar-compose.yml | tee -a _register.sh; \
	done
	chmod +x _register.sh
